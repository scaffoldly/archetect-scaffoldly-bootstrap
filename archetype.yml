---
script:

  - render:
      directory:
        source: "immutable"

  - if:
      conditions:
        - switch-enabled: overwrite
      then:
        - rules:
            - destination:
                overwrite: true
        - render:
            directory:
              source: "base"

  - if:
      conditions:
        - switch-enabled: overwrite
        - switch-enabled: aws
      then:
        - set:
            nonlive_domain:
              prompt: "Nonlive Domain"
            live_domain:
              prompt: "Live Domain"
        - rules:
            - destination:
                overwrite: true
        - render:
            directory:
              source: "aws/base"

  - if:
      conditions:
        - switch-enabled: serverless-api
      then:
          - set:
              serverless_api_repos:
                type: list

  - if:
      all-of: 
        - switch-enabled: overwrite
        - switch-enabled: aws
        - switch-enabled: serverless-api
      then:
        - for:
            item:
              in: serverless_api_repos
              name: repository-name
            do:
              - info: "Rendering AWS Serverless API for repository: {{ repository-name }}"
              - set:
                  repo: 
                    value: "{{ repository-name | lower }}"
                  service_name: 
                    value: "{{ repo | snake_case }}"
                  service-name: 
                    value: "{{ repo | train_case }}"
                  path: 
                    value: "{{ repo | trim_end_matches(pat='-sls-rest-api') }}"
              - rules:
                  - destination:
                      overwrite: true
              - render:
                  directory:
                    source: "aws/serverless-api"
