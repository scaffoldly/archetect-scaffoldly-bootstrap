---
script:

  - set:
      aws:
        default: "false"
        type: bool
      serverless_api_repos:
        default: ""
        type: list

  - render:
      directory:
        source: "immutable"

  - if:
      conditions:
        - switch-enabled: overwrite
      then:
        - set:
            nonlive_domain:
              prompt: "Nonlive Domain"
            live_domain:
              prompt: "Live Domain"
        - rules:
            - destination:
                overwrite: true
        - render:
            directory:
              source: "base"

  - if:
      all-of: 
        - is-true: "{{ aws }}"
        - is-true: "{{ serverless_api_repos | length != 0 }}"
        - switch-enabled: overwrite
      then:
        - for:
            item:
              in: serverless_api_repos
            do:
              - info: "Rendering AWS Serverless API: {{ item }}"
              - set:
                  repo: 
                    value: "{{ item | lower }}"
                  service_name: 
                    value: "{{ repo | snake_case }}"
                  service-name: 
                    value: "{{ repo | train_case }}"
                  path: 
                    value: "{{ repo | trim_end_matches(pat='-sls-rest-api') }}"
              - render:
                  directory:
                    source: "aws/serverless-api"
